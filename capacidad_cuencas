#include <stdio.h>
#include <stdlib.h>
#include "caudal.h"

// Cuenta cuantas lineas tiene el archivo
// sin contar el encabezado
int contarLineas(const char *nombreArchivo) {
    FILE *archivo = fopen(nombreArchivo, "r");
    //Comprobación de apertura, NULL=puntero vacío
	if (archivo == NULL) {
        printf("Error al abrir el archivo.\n");
        return -1;
    }

    int totalEmbalses = 0;
    char linea[1030];

    // Saltar la primera linea (cabecera)
    fgets(linea, sizeof(linea), archivo);

    // Contar el resto de lineas
    while (fgets(linea, sizeof(linea), archivo)) {
        totalEmbalses++;
    }
    printf("Numero de lineas del csv: %d",totalEmbalses);
    fclose(archivo);
    return totalEmbalses;
}

// Función para mostrar cuencas y embalses
void mostrarCuencasYEmbalses(Embalse *embalses, int totalEmbalses);
// Menu principal
void mostrarMenu() {
    printf("\n----------- ANALISIS DE CAUDALES EN ESPANA ----------\n");
    printf("\n----- ANIOS 2012-2021. TODOS LOS MESES INCLUIDOS-----\n");
	printf("\n1. Calcular medias anuales por cuenca y mes\n");
    printf("2. Ver evolucion de una cuenca\n");
    printf("3. Comparar dos cuencas en un anio\n");
    printf("4. Ver relacion caudal-produccion agricola\n");
    printf("5. Salir\n");
    printf("------------------------------------------\n");
    printf("Ingrese su opcion: ");
}

int main() {
	//en este trozo se declara el archivo csv que se quiere abrir
	//despues se usa el puntero *nombreArchivo para acortar
    Embalse *embalses = leerDatos("dataset.csv", &totalEmbalses);

    if (embalses == NULL) {
        printf("No se pudieron cargar los datos.\n");
        return 1;
    }

    int opcion;
    do {
        mostrarMenu();
        scanf("%d", &opcion);

        switch (opcion) {
            case 1:
                printf("Funcion en desarrollo: media anual caudal de cuenca.\n");
                break;
            case 2:
                printf("Funcion en desarrollo: evolucion de cuenca.\n");
                break;
            case 3:
                printf("Funcion en desarrollo: comparacion de cuencas.\n");
                break;
            case 4:
                printf("Funcion en desarrollo: caudal vs agricultura.\n");
                break;
            case 5:
                printf("Saliendo del programa...\n");
                break;
            default:
                printf("Opcion no valida. Intente de nuevo.\n");
                break;
        }
    } while (opcion != 5); //estructura do while para que el menú se 
                           //repita hasta que el usuario elija salir

    fclose(pf);
    return 0;
}
